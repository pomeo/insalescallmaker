{"version":3,"sources":["components/upload.js"],"names":["addon","component","window","UIkit","define","amd","UI","xhrupload","files","settings","upload","formData","FormData","xhr","XMLHttpRequest","before","f","i","append","param","p","params","addEventListener","e","percent","loaded","total","progress","loadstart","load","loadend","error","abort","open","method","action","onreadystatechange","readystatechange","readyState","response","responseText","type","$","parseJSON","complete","beforeSend","send","support","ajaxupload","this","extend","defaults","length","allow","file","matchName","name","alert","notallowed","single","count","uploaded","beforeAll","filelimit","allcomplete","pattern","path","parsedPattern","replace","match","RegExp","init","$this","on","element","options","twin","clone","data","replaceWith","dragoverClass","hasdragCls","dataTransfer","stopPropagation","preventDefault","removeClass","trigger","addClass","supportFileAPI","fi","document","createElement","supportAjaxUploadProgressEvents","supportFormData","event","props","push","Utils"],"mappings":"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","file":"components/upload.js","sourcesContent":["/*! UIkit 2.17.0 | http://www.getuikit.com | (c) 2014 YOOtheme | MIT License */\n(function(addon) {\n\n    var component;\n\n    if (window.UIkit) {\n        component = addon(UIkit);\n    }\n\n    if (typeof define == \"function\" && define.amd) {\n        define(\"uikit-upload\", [\"uikit\"], function(){\n            return component || addon(UIkit);\n        });\n    }\n\n})(function(UI){\n\n    \"use strict\";\n\n    UI.component('uploadSelect', {\n\n        init: function() {\n\n            var $this = this;\n\n            this.on(\"change\", function() {\n                xhrupload($this.element[0].files, $this.options);\n                var twin = $this.element.clone(true).data('uploadSelect', $this);\n                $this.element.replaceWith(twin);\n                $this.element = twin;\n            });\n        }\n    });\n\n    UI.component('uploadDrop', {\n\n        defaults: {\n            'dragoverClass': 'uk-dragover'\n        },\n\n        init: function() {\n\n            var $this = this, hasdragCls = false;\n\n            this.on(\"drop\", function(e){\n\n                if (e.dataTransfer && e.dataTransfer.files) {\n\n                    e.stopPropagation();\n                    e.preventDefault();\n\n                    $this.element.removeClass($this.options.dragoverClass);\n                    $this.element.trigger('dropped.uk.upload', [e.dataTransfer.files]);\n\n                    xhrupload(e.dataTransfer.files, $this.options);\n                }\n\n            }).on(\"dragenter\", function(e){\n                e.stopPropagation();\n                e.preventDefault();\n            }).on(\"dragover\", function(e){\n                e.stopPropagation();\n                e.preventDefault();\n\n                if (!hasdragCls) {\n                    $this.element.addClass($this.options.dragoverClass);\n                    hasdragCls = true;\n                }\n            }).on(\"dragleave\", function(e){\n                e.stopPropagation();\n                e.preventDefault();\n                $this.element.removeClass($this.options.dragoverClass);\n                hasdragCls = false;\n            });\n        }\n    });\n\n\n    UI.support.ajaxupload = (function() {\n\n        function supportFileAPI() {\n            var fi = document.createElement('INPUT'); fi.type = 'file'; return 'files' in fi;\n        }\n\n        function supportAjaxUploadProgressEvents() {\n            var xhr = new XMLHttpRequest(); return !! (xhr && ('upload' in xhr) && ('onprogress' in xhr.upload));\n        }\n\n        function supportFormData() {\n            return !! window.FormData;\n        }\n\n        return supportFileAPI() && supportAjaxUploadProgressEvents() && supportFormData();\n    })();\n\n    if (UI.support.ajaxupload){\n        UI.$.event.props.push(\"dataTransfer\");\n    }\n\n    function xhrupload(files, settings) {\n\n        if (!UI.support.ajaxupload){\n            return this;\n        }\n\n        settings = UI.$.extend({}, xhrupload.defaults, settings);\n\n        if (!files.length){\n            return;\n        }\n\n        if (settings.allow !== '*.*') {\n\n            for(var i=0,file;file=files[i];i++) {\n\n                if(!matchName(settings.allow, file.name)) {\n\n                    if(typeof(settings.notallowed) == 'string') {\n                       alert(settings.notallowed);\n                    } else {\n                       settings.notallowed(file, settings);\n                    }\n                    return;\n                }\n            }\n        }\n\n        var complete = settings.complete;\n\n        if (settings.single){\n\n            var count    = files.length,\n                uploaded = 0,\n                allow    = true;\n\n                settings.beforeAll(files);\n\n                settings.complete = function(response, xhr){\n\n                    uploaded = uploaded + 1;\n\n                    complete(response, xhr);\n\n                    if (settings.filelimit && uploaded >= settings.filelimit){\n                        allow = false;\n                    }\n\n                    if (allow && uploaded<count){\n                        upload([files[uploaded]], settings);\n                    } else {\n                        settings.allcomplete(response, xhr);\n                    }\n                };\n\n                upload([files[0]], settings);\n\n        } else {\n\n            settings.complete = function(response, xhr){\n                complete(response, xhr);\n                settings.allcomplete(response, xhr);\n            };\n\n            upload(files, settings);\n        }\n\n        function upload(files, settings){\n\n            // upload all at once\n            var formData = new FormData(), xhr = new XMLHttpRequest();\n\n            if (settings.before(settings, files)===false) return;\n\n            for (var i = 0, f; f = files[i]; i++) { formData.append(settings.param, f); }\n            for (var p in settings.params) { formData.append(p, settings.params[p]); }\n\n            // Add any event handlers here...\n            xhr.upload.addEventListener(\"progress\", function(e){\n                var percent = (e.loaded / e.total)*100;\n                settings.progress(percent, e);\n            }, false);\n\n            xhr.addEventListener(\"loadstart\", function(e){ settings.loadstart(e); }, false);\n            xhr.addEventListener(\"load\",      function(e){ settings.load(e);      }, false);\n            xhr.addEventListener(\"loadend\",   function(e){ settings.loadend(e);   }, false);\n            xhr.addEventListener(\"error\",     function(e){ settings.error(e);     }, false);\n            xhr.addEventListener(\"abort\",     function(e){ settings.abort(e);     }, false);\n\n            xhr.open(settings.method, settings.action, true);\n\n            xhr.onreadystatechange = function() {\n\n                settings.readystatechange(xhr);\n\n                if (xhr.readyState==4){\n\n                    var response = xhr.responseText;\n\n                    if (settings.type==\"json\") {\n                        try {\n                            response = UI.$.parseJSON(response);\n                        } catch(e) {\n                            response = false;\n                        }\n                    }\n\n                    settings.complete(response, xhr);\n                }\n            };\n            settings.beforeSend(xhr);\n            xhr.send(formData);\n        }\n    }\n\n    xhrupload.defaults = {\n        'action': '',\n        'single': true,\n        'method': 'POST',\n        'param' : 'files[]',\n        'params': {},\n        'allow' : '*.*',\n        'type'  : 'text',\n        'filelimit': false,\n\n        // events\n        'before'          : function(o){},\n        'beforeSend'      : function(xhr){},\n        'beforeAll'       : function(){},\n        'loadstart'       : function(){},\n        'load'            : function(){},\n        'loadend'         : function(){},\n        'error'           : function(){},\n        'abort'           : function(){},\n        'progress'        : function(){},\n        'complete'        : function(){},\n        'allcomplete'     : function(){},\n        'readystatechange': function(){},\n        'notallowed'      : function(file, settings){ alert('Only the following file types are allowed: '+settings.allow); }\n    };\n\n    function matchName(pattern, path) {\n\n        var parsedPattern = '^' + pattern.replace(/\\//g, '\\\\/').\n            replace(/\\*\\*/g, '(\\\\/[^\\\\/]+)*').\n            replace(/\\*/g, '[^\\\\/]+').\n            replace(/((?!\\\\))\\?/g, '$1.') + '$';\n\n        parsedPattern = '^' + parsedPattern + '$';\n\n        return (path.match(new RegExp(parsedPattern, 'i')) !== null);\n    }\n\n    UI.Utils.xhrupload = xhrupload;\n\n    return xhrupload;\n});\n"],"sourceRoot":"/source/"}